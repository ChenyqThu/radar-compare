# Manpower æ¨¡å—æ¶æ„è¯´æ˜

> ç‰ˆæœ¬: v2.2.0
> æ›´æ–°æ—¥æœŸ: 2026-01-14

## ğŸ“‹ ç›®å½•

- [æ¨¡å—æ¦‚è¿°](#æ¨¡å—æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [å…³é”®æŠ€æœ¯](#å…³é”®æŠ€æœ¯)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¨¡å—æ¦‚è¿°

Manpowerï¼ˆäººåŠ›æ’å¸ƒï¼‰æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å’Œå¯è§†åŒ–ç ”å‘å›¢é˜ŸäººåŠ›èµ„æºåˆ†é…çš„å·¥å…·ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **é…ç½®ç®¡ç†**
   - å›¢é˜Ÿé…ç½®ï¼ˆå®¹é‡ã€é¢œè‰²ã€æ ‡å·ï¼‰
   - é¡¹ç›®é…ç½®ï¼ˆçŠ¶æ€ã€å‘å¸ƒæ—¥æœŸã€å…³è”å›¢é˜Ÿï¼‰
   - æ—¶é—´ç‚¹é…ç½®ï¼ˆåç§°ã€æ—¥æœŸã€ç±»å‹ï¼‰

2. **äººåŠ›åˆ†é…**
   - å¯ç¼–è¾‘çš„åˆ†é…è¡¨æ ¼
   - æŠ•å…¥/é¢„é‡ŠåŒå€¼ç®¡ç†
   - è‡ªåŠ¨è®¡ç®—å’Œæ ¡å‡†
   - åˆ©ç”¨ç‡å®æ—¶ç›‘æ§

3. **å¯è§†åŒ–åˆ†æ**
   - Sankey æµåŠ¨å›¾
   - åˆ†å¸ƒè¶‹åŠ¿å›¾
   - é¡¹ç›®æŸ±çŠ¶å›¾

4. **æ•°æ®é›†æˆ**
   - Excel å¯¼å…¥å¯¼å‡º
   - JSON å¯¼å…¥å¯¼å‡º
   - æ¨¡æ¿ä¸‹è½½

5. **åä½œæ”¯æŒ**
   - åªè¯»æ¨¡å¼ï¼ˆåˆ†äº«åœºæ™¯ï¼‰
   - å®æ—¶æ•°æ®åŒæ­¥
   - äº‘ç«¯æŒä¹…åŒ–

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ManpowerView (ä¸»å®¹å™¨)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Tab 1: åˆ†é…è¡¨æ ¼                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚        AllocationGrid                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - å¤šçº§è¡¨å¤´                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - å¯ç¼–è¾‘å•å…ƒæ ¼                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - åˆ©ç”¨ç‡ç›‘æ§                             â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Tab 2: å¯è§†åŒ–åˆ†æ                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  SankeyChart (æµåŠ¨å›¾)                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  DistributionChart (åˆ†å¸ƒå›¾)               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  ProjectBarChart (æŸ±çŠ¶å›¾)                 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Store å±‚ (Zustand)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ configStore  â”‚  â”‚  dataStore   â”‚  â”‚ radarStore  â”‚  â”‚
â”‚  â”‚  (é€‚é…å™¨)     â”‚  â”‚   (é€‚é…å™¨)    â”‚  â”‚  (æ ¸å¿ƒ)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Excel æœåŠ¡   â”‚  â”‚ Supabase     â”‚  â”‚ å·¥å…·å‡½æ•°    â”‚  â”‚
â”‚  â”‚ (å¯¼å…¥å¯¼å‡º)    â”‚  â”‚  (æŒä¹…åŒ–)     â”‚  â”‚ (ID/å¸¸é‡)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡åŸåˆ™

#### 1. é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰

**é—®é¢˜**: Manpower æ¨¡å—éœ€è¦é›†æˆåˆ°ç°æœ‰çš„ radarStore ä¸­ï¼Œä½†ä¸å¸Œæœ›ä¾µå…¥å¼ä¿®æ”¹ã€‚

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œé€šè¿‡ `configStore` å’Œ `dataStore` å°† radarStore çš„æ¥å£é€‚é…ä¸ºç»„ä»¶æœŸæœ›çš„æ¥å£ã€‚

```typescript
// configStore.ts - é€‚é…å™¨
export function useConfigStore(): ConfigState {
  const { getActiveManpowerChart, addManpowerTeam, ... } = useRadarStore()

  return {
    teams: chart?.teams ?? [],
    projects: chart?.projects ?? [],
    addTeam: (team) => addManpowerTeam(chartId, team),
    ...
  }
}
```

**ä¼˜ç‚¹**:
- âœ… ç»„ä»¶ä¸ç›´æ¥ä¾èµ– radarStore
- âœ… ä¾¿äºæµ‹è¯•å’Œè¿ç§»
- âœ… æ¥å£æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜

#### 2. é…ç½®ä¸­å¿ƒåŒ–ï¼ˆCentralized Configurationï¼‰

**é—®é¢˜**: é…ç½®å¸¸é‡åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œéš¾ä»¥ç»´æŠ¤å’Œè°ƒæ•´ã€‚

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»º `constants.ts` ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®ã€‚

```typescript
// constants.ts
export const UTILIZATION_THRESHOLDS = { critical: 110, overload: 100, ... }
export const STORAGE_KEYS = { showTeamDetails: '...', ... }
export function getUtilizationStyle(percentage: number) { ... }
```

**ä¼˜ç‚¹**:
- âœ… é…ç½®æ˜“äºæŸ¥æ‰¾å’Œä¿®æ”¹
- âœ… é¿å…é­”æ³•æ•°å­—
- âœ… æ”¯æŒä¸»é¢˜å®šåˆ¶

---

## ç›®å½•ç»“æ„

```
src/components/manpower/
â”œâ”€â”€ ManpowerView.tsx              # ä¸»è§†å›¾å®¹å™¨ (Tab åˆ‡æ¢)
â”œâ”€â”€ ManpowerToolbar.tsx           # å·¥å…·æ  (å¯¼å…¥å¯¼å‡º)
â”œâ”€â”€ TeamBadge.tsx                 # å›¢é˜Ÿå¾½ç« ç»„ä»¶
â”œâ”€â”€ ProjectBadge.tsx              # é¡¹ç›®å¾½ç« ç»„ä»¶
â”œâ”€â”€ constants.ts                  # é…ç½®å¸¸é‡ (NEW)
â”œâ”€â”€ ManpowerView.module.css       # ä¸»è§†å›¾æ ·å¼
â”œâ”€â”€ ManpowerToolbar.module.css    # å·¥å…·æ æ ·å¼
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ configStore.ts            # é…ç½® Store é€‚é…å™¨
â”‚   â””â”€â”€ dataStore.ts              # æ•°æ® Store é€‚é…å™¨
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useI18n.ts                # å›½é™…åŒ– Hook
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ allocation/
â”‚   â”‚   â”œâ”€â”€ AllocationGrid.tsx    # äººåŠ›åˆ†é…è¡¨æ ¼ (682 è¡Œ)
â”‚   â”‚   â””â”€â”€ AllocationGrid.module.css
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ TeamConfig.tsx        # å›¢é˜Ÿé…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ProjectConfig.tsx     # é¡¹ç›®é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ TimeConfig.tsx        # æ—¶é—´ç‚¹é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ *.module.css          # å„æ¨¡å—æ ·å¼
â”‚   â””â”€â”€ visualization/
â”‚       â”œâ”€â”€ SankeyChart.tsx       # Sankey æµåŠ¨å›¾
â”‚       â”œâ”€â”€ DistributionChart.tsx # åˆ†å¸ƒè¶‹åŠ¿å›¾
â”‚       â”œâ”€â”€ ProjectBarChart.tsx   # é¡¹ç›®æŸ±çŠ¶å›¾
â”‚       â””â”€â”€ *.module.css          # å›¾è¡¨æ ·å¼
â””â”€â”€ types/
    â””â”€â”€ index.ts                  # ç±»å‹å…¼å®¹å±‚

src/types/
â””â”€â”€ manpower.ts                   # Manpower ç±»å‹å®šä¹‰

src/stores/radarStore/
â””â”€â”€ manpowerActions.ts            # Manpower Store Actions

src/services/excel/
â”œâ”€â”€ manpowerExporter.ts           # Excel å¯¼å‡ºæœåŠ¡
â””â”€â”€ manpowerImporter.ts           # Excel å¯¼å…¥æœåŠ¡

src/utils/
â””â”€â”€ idGenerator.ts                # ç»Ÿä¸€ ID ç”Ÿæˆå™¨ (NEW)
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. ManpowerView (ä¸»è§†å›¾)

**èŒè´£**: Tab å®¹å™¨ï¼Œç®¡ç†é…ç½®å’Œå¯è§†åŒ–ä¸¤ä¸ª Tab çš„åˆ‡æ¢ã€‚

**å…³é”®ç‰¹æ€§**:
- ä½¿ç”¨ Ant Design Tabs ç»„ä»¶
- æ”¯æŒåªè¯»æ¨¡å¼ (readonly prop)
- é›†æˆå·¥å…·æ  (å¯¼å…¥å¯¼å‡º)

**Props**:
```typescript
interface ManpowerViewProps {
  readonly?: boolean  // åªè¯»æ¨¡å¼ï¼Œç”¨äºåˆ†äº«åœºæ™¯
}
```

### 2. AllocationGrid (åˆ†é…è¡¨æ ¼)

**èŒè´£**: æ ¸å¿ƒçš„äººåŠ›åˆ†é…ç¼–è¾‘è¡¨æ ¼ï¼Œæ”¯æŒå¤šç»´åº¦æ•°æ®è¾“å…¥å’Œå®æ—¶è®¡ç®—ã€‚

**å…³é”®ç‰¹æ€§**:
- **å¤šçº§è¡¨å¤´**: æ—¶é—´ç‚¹ â†’ æŠ•å…¥/é¢„é‡Š
- **å†»ç»“åˆ—**: é¡¹ç›®å’Œå›¢é˜Ÿåˆ—å›ºå®šï¼Œæ¨ªå‘æ»šåŠ¨æ—¶ä¿æŒå¯è§
- **å¯ç¼–è¾‘å•å…ƒæ ¼**: ä½¿ç”¨ InputNumber ç»„ä»¶ï¼Œæ”¯æŒé”®ç›˜å¯¼èˆª
- **åˆ©ç”¨ç‡ç›‘æ§**: å®æ—¶è®¡ç®—å›¢é˜Ÿåˆ©ç”¨ç‡ï¼Œé¢œè‰²æ ‡è¯† (ç»¿/é»„/æ©™/çº¢)
- **è‡ªåŠ¨è®¡ç®—**: é¢„é‡Šå€¼è‡ªåŠ¨æ›´æ–°ä¸‹ä¸ªæ—¶é—´ç‚¹çš„æŠ•å…¥å€¼
- **æŠ˜å å±•å¼€**: æ”¯æŒé¡¹ç›®çº§åˆ«çš„æŠ˜å /å±•å¼€
- **å›¢é˜Ÿè¯¦æƒ…**: å¯é€‰æ˜¾ç¤º/éšè—å›¢é˜Ÿæ˜ç»†è¡Œ

**çŠ¶æ€ç®¡ç†**:
```typescript
const [showTeamDetails, setShowTeamDetails] = useState(true)
const [collapsedProjects, setCollapsedProjects] = useState<Set<string>>(new Set())
```

**åˆ©ç”¨ç‡è®¡ç®—**:
```typescript
// å›¢é˜Ÿåˆ©ç”¨ç‡ = (å·²åˆ†é…äººåŠ› / å›¢é˜Ÿå®¹é‡) Ã— 100%
const utilization = (allocated / capacity) * 100

// é¢œè‰²é˜ˆå€¼ (æ¥è‡ª constants.ts)
// > 110%: çº¢è‰² (ä¸¥é‡è¶…è½½)
// > 100%: æ©™è‰² (è¶…è½½)
// > 90%:  é»„è‰² (è­¦å‘Š)
// â‰¤ 90%:  ç»¿è‰² (æ­£å¸¸)
```

### 3. Store é€‚é…å™¨

#### configStore (é…ç½®é€‚é…å™¨)

**èŒè´£**: å°† radarStore çš„é…ç½®æ¥å£é€‚é…ä¸ºç»„ä»¶æœŸæœ›çš„æ¥å£ã€‚

**æä¾›çš„æ¥å£**:
```typescript
interface ConfigState {
  teams: Team[]
  projects: Project[]
  timePoints: TimePoint[]

  addTeam: (team: Team) => void
  updateTeam: (id: string, updates: Partial<Team>) => void
  deleteTeam: (id: string) => void

  addProject: (project: Project) => void
  updateProject: (id: string, updates: Partial<Project>) => void
  deleteProject: (id: string) => void

  addTimePoint: (timePoint: TimePoint) => void
  updateTimePoint: (id: string, updates: Partial<TimePoint>) => void
  deleteTimePoint: (id: string) => void

  importConfig: (config: { teams, projects, timePoints }) => void
}
```

#### dataStore (æ•°æ®é€‚é…å™¨)

**èŒè´£**: ç®¡ç†åˆ†é…æ•°æ®å’Œè®¡ç®—é€»è¾‘ã€‚

**æä¾›çš„æ¥å£**:
```typescript
interface DataState {
  allocations: AllocationMatrix
  validationResults: ValidationResult[]
  sankeyData: SankeyData | null
  isLoading: boolean

  updateAllocation: (timePointId, projectId, teamId, data) => void
  updateMultipleAllocations: (updates[]) => void

  setValidationResults: (results: ValidationResult[]) => void
  clearValidationResults: () => void

  setSankeyData: (data: SankeyData | null) => void
  setLoading: (isLoading: boolean) => void

  getAllocationByKeys: (timePointId, projectId, teamId) => Allocation
  getTeamTotalAtTime: (timePointId, teamId) => number
  getProjectTotalAtTime: (timePointId, projectId) => number
  getStatistics: () => { totalCapacity, totalAllocated, totalPrerelease }

  resetAllocations: () => void
  importAllocations: (allocations: AllocationMatrix) => void
}
```

### 4. å¯è§†åŒ–ç»„ä»¶

#### SankeyChart (æµåŠ¨å›¾)

**èŒè´£**: å±•ç¤ºäººåŠ›åœ¨ä¸åŒæ—¶é—´ç‚¹çš„æµåŠ¨å’Œåˆ†é…å…³ç³»ã€‚

**æ•°æ®ç»“æ„**:
```typescript
interface SankeyData {
  nodes: SankeyNode[]  // èŠ‚ç‚¹ (å›¢é˜Ÿã€é¡¹ç›®)
  links: SankeyLink[]  // è¿æ¥ (äººåŠ›æµåŠ¨)
}
```

**ç‰¹æ€§**:
- æ”¯æŒå›¢é˜Ÿè¯¦æƒ…å±•å¼€/æŠ˜å 
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- è‡ªåŠ¨è®¡ç®—èŠ‚ç‚¹å’Œè¿æ¥çš„å€¼

#### DistributionChart (åˆ†å¸ƒè¶‹åŠ¿å›¾)

**èŒè´£**: é¥¼å›¾ + æŠ˜çº¿å›¾è”åŠ¨ï¼Œå±•ç¤ºé¡¹ç›®äººåŠ›æŠ•å…¥è¶‹åŠ¿ã€‚

**ç‰¹æ€§**:
- å·¦ä¾§é¥¼å›¾: å½“å‰æ—¶é—´ç‚¹çš„é¡¹ç›®åˆ†å¸ƒ
- å³ä¾§æŠ˜çº¿å›¾: å„é¡¹ç›®éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿
- ç‚¹å‡»é¥¼å›¾åˆ‡ç‰‡é«˜äº®å¯¹åº”æŠ˜çº¿

#### ProjectBarChart (é¡¹ç›®æŸ±çŠ¶å›¾)

**èŒè´£**: æŒ‰æ—¶é—´æ®µåˆ†ç»„å±•ç¤ºç‰ˆæœ¬äººåŠ›æŠ•å…¥æ€»è§ˆã€‚

**ç‰¹æ€§**:
- å †å æŸ±çŠ¶å›¾: æ¯ä¸ªæŸ±å­ä»£è¡¨ä¸€ä¸ªæ—¶é—´ç‚¹
- é¢œè‰²åŒºåˆ†: ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒé¢œè‰²
- å›¾ä¾‹äº¤äº’: ç‚¹å‡»å›¾ä¾‹æ˜¾ç¤º/éšè—é¡¹ç›®

---

## æ•°æ®æµ

### 1. æ•°æ®è¯»å–æµç¨‹

```
ç”¨æˆ·æ“ä½œ
  â†“
ManpowerView ç»„ä»¶
  â†“
useConfigStore() / useDataStore()  â† é€‚é…å™¨å±‚
  â†“
useRadarStore()                     â† æ ¸å¿ƒ Store
  â†“
getActiveManpowerChart()            â† è·å–å½“å‰å›¾è¡¨
  â†“
è¿”å› ManpowerChart æ•°æ®
  â†“
ç»„ä»¶æ¸²æŸ“
```

**å…³é”®ç‚¹**:
- é€‚é…å™¨å±‚éš”ç¦»äº†ç»„ä»¶å’Œ radarStore çš„ç›´æ¥ä¾èµ–
- æ‰€æœ‰æ•°æ®é€šè¿‡ `getActiveManpowerChart()` è·å–
- ç»„ä»¶åªä¾èµ–é€‚é…å™¨æ¥å£ï¼Œä¸å…³å¿ƒåº•å±‚å®ç°

### 2. æ•°æ®å†™å…¥æµç¨‹

```
ç”¨æˆ·ç¼–è¾‘ (AllocationGrid)
  â†“
updateAllocation(timePointId, projectId, teamId, data)
  â†“
dataStore.updateAllocation()        â† é€‚é…å™¨æ–¹æ³•
  â†“
radarStore.updateAllocation()       â† æ ¸å¿ƒ Store æ–¹æ³•
  â†“
æ›´æ–° chart.allocations[timePointId][projectId][teamId]
  â†“
è§¦å‘ debouncedSaveChart()           â† é˜²æŠ–ä¿å­˜ (500ms)
  â†“
Supabase API                        â† äº‘ç«¯æŒä¹…åŒ–
  â†“
æ›´æ–°æˆåŠŸï¼ŒUI è‡ªåŠ¨åˆ·æ–°
```

**å…³é”®ç‚¹**:
- é˜²æŠ–ä¿å­˜é¿å…é¢‘ç¹ API è°ƒç”¨
- æ‰¹é‡æ›´æ–°ä½¿ç”¨ `updateMultipleAllocations`
- ä¿å­˜å¤±è´¥æ—¶æœ‰é”™è¯¯æç¤º

### 3. Excel å¯¼å…¥æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
  â†“
ManpowerToolbar.handleImport()
  â†“
importManpowerFromExcel(file)       â† Service å±‚
  â†“
è§£æ Excel æ–‡ä»¶ (SheetJS)
  â†“
æ•°æ®æ ¡éªŒ (ValidationResult[])
  â†“
è¿”å› { isValid, data, errors, warnings }
  â†“
configStore.importConfig()          â† å¯¼å…¥é…ç½®
  â†“
dataStore.importAllocations()       â† å¯¼å…¥åˆ†é…æ•°æ®
  â†“
æ‰¹é‡æ›´æ–°åˆ° radarStore
  â†“
è‡ªåŠ¨ä¿å­˜åˆ° Supabase
  â†“
æ˜¾ç¤ºæˆåŠŸ/é”™è¯¯æ¶ˆæ¯
```

**å…³é”®ç‚¹**:
- å…ˆæ ¡éªŒåå¯¼å…¥ï¼Œé¿å…è„æ•°æ®
- æ”¯æŒéƒ¨åˆ†å¯¼å…¥ (åªå¯¼å…¥é…ç½®æˆ–åªå¯¼å…¥åˆ†é…)
- é”™è¯¯å’Œè­¦å‘Šåˆ†åˆ«å¤„ç†

### 4. å¯è§†åŒ–æ•°æ®æµ

```
AllocationGrid æ•°æ®å˜åŒ–
  â†“
dataStore.allocations æ›´æ–°
  â†“
SankeyChart / DistributionChart / ProjectBarChart
  â†“
useMemo é‡æ–°è®¡ç®—å›¾è¡¨æ•°æ®
  â†“
ç”Ÿæˆ ECharts option
  â†“
ReactECharts æ¸²æŸ“
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœ
- åªåœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°è®¡ç®—
- ECharts è‡ªåŠ¨å¤„ç†åŠ¨ç”»è¿‡æ¸¡

---

## å…³é”®æŠ€æœ¯

### 1. Ant Design v5

**ä½¿ç”¨çš„ç»„ä»¶**:
- `Table`: åˆ†é…è¡¨æ ¼çš„åŸºç¡€ç»„ä»¶
- `Form`: é…ç½®è¡¨å•
- `Modal`: å¼¹çª—
- `InputNumber`: æ•°å­—è¾“å…¥
- `DatePicker`: æ—¥æœŸé€‰æ‹©
- `ColorPicker`: é¢œè‰²é€‰æ‹©
- `Select`: ä¸‹æ‹‰é€‰æ‹©
- `Button`, `Space`, `Divider`: åŸºç¡€ç»„ä»¶

**ä¸»é¢˜é›†æˆ**:
```typescript
// é€šè¿‡ CSS å˜é‡ä¸ä¸»é¡¹ç›®ä¸»é¢˜ç³»ç»Ÿé›†æˆ
ConfigProvider.config({
  theme: {
    token: {
      colorPrimary: 'var(--primary-color)',
      colorBgContainer: 'var(--card-bg)',
      // ...
    }
  }
})
```

### 2. ECharts 5

**ä½¿ç”¨çš„å›¾è¡¨ç±»å‹**:
- **Sankey**: æµåŠ¨å›¾ï¼Œå±•ç¤ºäººåŠ›æµåŠ¨
- **Pie**: é¥¼å›¾ï¼Œå±•ç¤ºé¡¹ç›®åˆ†å¸ƒ
- **Line**: æŠ˜çº¿å›¾ï¼Œå±•ç¤ºè¶‹åŠ¿
- **Bar**: æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºç‰ˆæœ¬æŠ•å…¥

**é…ç½®è¦ç‚¹**:
```typescript
// ä¸»é¢˜é€‚é…
const theme = isDark ? 'dark' : 'light'

// å“åº”å¼
const option = {
  grid: { containLabel: true },
  // ...
}

// åŠ¨ç”»
const option = {
  animation: true,
  animationDuration: 600,
  // ...
}
```

### 3. CSS Modules + CSS Variables

**æ ·å¼éš”ç¦»**:
```typescript
import styles from './AllocationGrid.module.css'

<div className={styles.container}>
  <div className={styles.header}>...</div>
</div>
```

**ä¸»é¢˜å˜é‡**:
```css
/* ä½¿ç”¨ä¸»é¡¹ç›®çš„ CSS å˜é‡ */
.container {
  background: var(--card-bg);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

/* æ·±è‰²/æµ…è‰²ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢ */
[data-theme='dark'] .container {
  /* CSS å˜é‡è‡ªåŠ¨æ›´æ–° */
}
```

### 4. TypeScript ç±»å‹ç³»ç»Ÿ

**æ ¸å¿ƒç±»å‹**:
```typescript
// å›¢é˜Ÿ
interface Team {
  id: string
  name: string
  capacity: number
  color: string
  badge: string
}

// é¡¹ç›®
interface Project {
  id: string
  name: string
  status: 'planning' | 'in-progress' | 'released'
  releaseDate?: string
  color: string
  pattern: string
  teams: string[]  // å…³è”çš„å›¢é˜Ÿ ID
}

// æ—¶é—´ç‚¹
interface TimePoint {
  id: string
  name: string
  date: string
  type: 'milestone' | 'sprint' | 'quarter'
}

// åˆ†é…çŸ©é˜µ
type AllocationMatrix = {
  [timePointId: string]: {
    [projectId: string]: {
      [teamId: string]: {
        occupied: number    // æŠ•å…¥äººåŠ›
        prerelease: number  // é¢„é‡ŠäººåŠ›
      }
    }
  }
}

// Manpower å›¾è¡¨
interface ManpowerChart {
  id: string
  name: string
  chart_type: 'manpower'
  order: number
  teams: Team[]
  projects: Project[]
  timePoints: TimePoint[]
  allocations: AllocationMatrix
  createdAt: number
  updatedAt: number
}
```

### 5. Zustand Store

**é€‚é…å™¨æ¨¡å¼**:
```typescript
// configStore.ts - é€‚é…å™¨
export function useConfigStore(): ConfigState {
  const { getActiveManpowerChart, addManpowerTeam, ... } = useRadarStore()

  const chart = getActiveManpowerChart()

  return {
    teams: chart?.teams ?? [],
    addTeam: (team) => addManpowerTeam(chart.id, team),
    // ...
  }
}
```

**ä¼˜ç‚¹**:
- ç»„ä»¶ä¸ç›´æ¥ä¾èµ– radarStore
- ä¾¿äºæµ‹è¯•å’Œè¿ç§»
- æ¥å£æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜

### 6. SheetJS (xlsx)

**Excel å¯¼å‡º**:
```typescript
import * as XLSX from 'xlsx'

const wb = XLSX.utils.book_new()
const ws = XLSX.utils.aoa_to_sheet(data)
XLSX.utils.book_append_sheet(wb, ws, 'Sheet1')
XLSX.writeFile(wb, 'manpower.xlsx')
```

**Excel å¯¼å…¥**:
```typescript
const wb = XLSX.read(await file.arrayBuffer())
const ws = wb.Sheets[wb.SheetNames[0]]
const data = XLSX.utils.sheet_to_json(ws)
```

---

## æœ€ä½³å®è·µ

### 1. ç»„ä»¶å¼€å‘

**å•ä¸€èŒè´£åŸåˆ™**:
```typescript
// âœ… å¥½ - èŒè´£æ¸…æ™°
const TeamBadge = ({ team }) => (
  <span style={{ backgroundColor: team.color }}>
    {team.badge} {team.name}
  </span>
)

// âŒ å·® - èŒè´£æ··ä¹±
const TeamBadge = ({ team, onEdit, onDelete, showActions }) => {
  // åŒ…å«äº†ç¼–è¾‘ã€åˆ é™¤ç­‰ä¸šåŠ¡é€»è¾‘
}
```

**Props ç±»å‹å®šä¹‰**:
```typescript
// âœ… å¥½ - æ˜ç¡®çš„ç±»å‹å®šä¹‰
interface AllocationGridProps {
  readonly?: boolean
}

// âŒ å·® - ä½¿ç”¨ any
interface AllocationGridProps {
  config?: any
}
```

### 2. çŠ¶æ€ç®¡ç†

**ä½¿ç”¨é€‚é…å™¨éš”ç¦»ä¾èµ–**:
```typescript
// âœ… å¥½ - é€šè¿‡é€‚é…å™¨è®¿é—®
const { teams, addTeam } = useConfigStore()

// âŒ å·® - ç›´æ¥ä¾èµ– radarStore
const { getActiveManpowerChart, addManpowerTeam } = useRadarStore()
```

**æ‰¹é‡æ›´æ–°ä¼˜åŒ–**:
```typescript
// âœ… å¥½ - æ‰¹é‡æ›´æ–°
updateMultipleAllocations([
  { timePointId: 't1', projectId: 'p1', teamId: 'team1', data: { occupied: 5, prerelease: 0 } },
  { timePointId: 't1', projectId: 'p1', teamId: 'team2', data: { occupied: 3, prerelease: 0 } },
])

// âŒ å·® - å¤šæ¬¡å•ç‹¬æ›´æ–°
updateAllocation('t1', 'p1', 'team1', { occupied: 5, prerelease: 0 })
updateAllocation('t1', 'p1', 'team2', { occupied: 3, prerelease: 0 })
```

### 3. æ ·å¼å¼€å‘

**ä½¿ç”¨ CSS å˜é‡**:
```css
/* âœ… å¥½ - ä½¿ç”¨ä¸»é¢˜å˜é‡ */
.container {
  background: var(--card-bg);
  color: var(--text-primary);
}

/* âŒ å·® - ç¡¬ç¼–ç é¢œè‰² */
.container {
  background: #ffffff;
  color: #000000;
}
```

**CSS Modules å‘½å**:
```typescript
// âœ… å¥½ - è¯­ä¹‰åŒ–å‘½å
<div className={styles.allocationGrid}>
  <div className={styles.header}>...</div>
</div>

// âŒ å·® - æ— æ„ä¹‰å‘½å
<div className={styles.container1}>
  <div className={styles.box2}>...</div>
</div>
```

### 4. æ€§èƒ½ä¼˜åŒ–

**ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—**:
```typescript
// âœ… å¥½ - ç¼“å­˜è®¡ç®—ç»“æœ
const sankeyData = useMemo(() => {
  return generateSankeyData(allocations, teams, projects)
}, [allocations, teams, projects])

// âŒ å·® - æ¯æ¬¡æ¸²æŸ“éƒ½è®¡ç®—
const sankeyData = generateSankeyData(allocations, teams, projects)
```

**é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“**:
```typescript
// âœ… å¥½ - ä½¿ç”¨ useCallback
const handleUpdate = useCallback((id, data) => {
  updateTeam(id, data)
}, [updateTeam])

// âŒ å·® - æ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°
const handleUpdate = (id, data) => {
  updateTeam(id, data)
}
```

### 5. é”™è¯¯å¤„ç†

**ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º**:
```typescript
// âœ… å¥½ - æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
try {
  await importManpowerFromExcel(file)
  message.success(t.toolbar.importSuccess)
} catch (error) {
  message.error(`${t.toolbar.importFailed}: ${error.message}`)
  console.error('Import error:', error)
}

// âŒ å·® - é™é»˜å¤±è´¥
try {
  await importManpowerFromExcel(file)
} catch (error) {
  console.error(error)
}
```

**æ•°æ®æ ¡éªŒ**:
```typescript
// âœ… å¥½ - å…ˆæ ¡éªŒåå¤„ç†
const result = await importManpowerFromExcel(file)
if (!result.isValid) {
  message.error(result.errors.map(e => e.message).join('\n'))
  return
}
// å¤„ç†æœ‰æ•ˆæ•°æ®

// âŒ å·® - ç›´æ¥å¤„ç†ï¼Œå¯èƒ½å¯¼è‡´è„æ•°æ®
const data = await importManpowerFromExcel(file)
importAllocations(data.allocations)
```

### 6. ä»£ç ç»„ç»‡

**ç»Ÿä¸€çš„ ID ç”Ÿæˆ**:
```typescript
// âœ… å¥½ - ä½¿ç”¨ç»Ÿä¸€å·¥å…·
import { idGenerators } from '@/utils/idGenerator'
const newTeam = { id: idGenerators.team(), ... }

// âŒ å·® - å¤šç§æ–¹å¼æ··ç”¨
const newTeam = { id: nanoid(), ... }
const newProject = { id: crypto.randomUUID(), ... }
const newTimePoint = { id: `time-${Date.now()}`, ... }
```

**é…ç½®é›†ä¸­ç®¡ç†**:
```typescript
// âœ… å¥½ - ä» constants å¯¼å…¥
import { UTILIZATION_THRESHOLDS, getUtilizationStyle } from './constants'
if (percentage > UTILIZATION_THRESHOLDS.critical) { ... }

// âŒ å·® - é­”æ³•æ•°å­—
if (percentage > 110) { ... }
```

### 7. å›½é™…åŒ–

**å®Œæ•´çš„ i18n æ”¯æŒ**:
```typescript
// âœ… å¥½ - æ‰€æœ‰æ–‡æœ¬éƒ½å›½é™…åŒ–
const { t } = useI18n()
<Button>{t.manpower.addTeam}</Button>

// âŒ å·® - ç¡¬ç¼–ç æ–‡æœ¬
<Button>æ·»åŠ å›¢é˜Ÿ</Button>
```

### 8. åªè¯»æ¨¡å¼æ”¯æŒ

**Props ä¼ é€’**:
```typescript
// âœ… å¥½ - æ”¯æŒåªè¯»æ¨¡å¼
<ManpowerView readonly={isShareMode} />

// ç»„ä»¶å†…éƒ¨
<InputNumber disabled={readonly} />
{!readonly && <Button>ç¼–è¾‘</Button>}
```

---

## æ€»ç»“

Manpower æ¨¡å—æ˜¯ä¸€ä¸ª**é«˜è´¨é‡ã€æ˜“ç»´æŠ¤ã€åŠŸèƒ½å®Œæ•´**çš„ç”Ÿäº§çº§ä»£ç æ¨¡å—ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… **æ¶æ„æ¸…æ™°**: é€‚é…å™¨æ¨¡å¼éš”ç¦»ä¾èµ–
- âœ… **ç±»å‹å®Œå–„**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… **ä»£ç è´¨é‡é«˜**: ç»Ÿä¸€çš„ ID ç”Ÿæˆã€é…ç½®é›†ä¸­ç®¡ç†
- âœ… **å¯ç»´æŠ¤æ€§å¼º**: ä»£ç é‡å¤ç‡ä½ã€èŒè´£åˆ†æ˜
- âœ… **åŠŸèƒ½å®Œæ•´**: é…ç½®ã€åˆ†é…ã€å¯è§†åŒ–ã€å¯¼å…¥å¯¼å‡º
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**: åªè¯»æ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å›½é™…åŒ–

**æŠ€æœ¯æ ˆ**:
- React 18 + TypeScript
- Ant Design v5
- ECharts 5
- Zustand (é€‚é…å™¨æ¨¡å¼)
- CSS Modules + CSS Variables
- SheetJS (Excel)

**æ–‡æ¡£å®Œæ•´æ€§**:
- âœ… æ¶æ„è¯´æ˜ (æœ¬æ–‡æ¡£)
- âœ… ä¼˜åŒ–è®°å½• (`OPTIMIZATION_2026_01.md`)
- âœ… ä¸»æ–‡æ¡£æ›´æ–° (`CLAUDE.md`)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-14
**æœ€åæ›´æ–°**: 2026-01-14
