# Product Matrix 技术决策记录

## 1. 花瓣图渲染方案选择

### 决策日期
2026-01-21

### 背景
设计阶段规划了两种花瓣图渲染方案：
1. **Canvas 方案**: 自定义 `PetalChartRenderer.ts`，完全手动绘制
2. **ECharts 方案**: 使用 ECharts Custom Series

### 最终选择
**ECharts Custom Series**

### 选择原因

| 考量因素 | Canvas 方案 | ECharts 方案 |
|----------|-------------|--------------|
| 开发成本 | 高（需实现完整渲染、事件、动画） | 低（复用 ECharts 基础设施） |
| 代码量 | 约 500-800 行 | 约 200 行 |
| Tooltip | 需手动实现 | 开箱即用 |
| 动画效果 | 需手动实现 | 开箱即用 |
| 响应式 | 需手动处理 resize | 自动处理 |
| 与项目一致性 | 引入新的渲染模式 | 与雷达图等模块一致 |
| 自定义能力 | 极高 | 中等（满足当前需求） |

### 权衡取舍
- **放弃**: 极致的自定义能力（如状态分区填充等高级效果）
- **获得**: 更快的开发速度、更少的代码维护成本、更好的项目一致性

### 未来考虑
如果后续需要更复杂的花瓣图交互（如：
- 状态分区填充
- 复杂的拖拽交互
- 自定义动画路径
），可以考虑迁移到 Canvas 方案。当前实现已将渲染逻辑封装在 `useChartOption.ts` 中，便于未来替换。

---

## 2. 状态管理方案

### 决策
使用 Store Adapter 模式，而非在主 Store 中直接管理

### 原因
- 与 Manpower 模块保持一致
- 降低主 Store 的复杂度
- 便于模块级别的状态隔离

---

## 3. 文件拆分策略

### 决策
将 MatrixChart.tsx (430行) 拆分为 5 个子模块

### 拆分结果
- `index.tsx` (106 行) - 主组件
- `types.ts` (57 行) - 类型定义
- `useMatrixChartData.ts` (156 行) - 数据处理
- `useChartOption.ts` (163 行) - ECharts 配置
- `AxisToolbar.tsx` (99 行) - 轴选择器

### 原因
- 遵循项目 400 行代码上限规范
- 提高可测试性（Hooks 可独立测试）
- 职责分离，便于维护
