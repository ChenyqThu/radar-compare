# 产品矩阵（Product Matrix）- 需求分析与方案设计总览

> 为 Radar Compare 工具新增的竞品对比可视化模块

---

## 📋 文档导航

本次需求分析和方案设计包含以下文档：

| 文档 | 内容 | 适用对象 |
|------|------|----------|
| **本文档** | 总览和快速开始 | 所有人 |
| [数据模型](./data-model.md) | 数据结构、类型定义、存储方案（含产品状态和花瓣图配置） | 开发人员 |
| [功能设计](./feature-design.md) | 功能模块、UI 设计、交互流程 | 产品经理、设计师、开发人员 |
| [花瓣图可视化设计](./petal-visualization-design.md) | 花瓣图详细设计、多维度编码、Canvas 渲染方案 | 开发人员、设计师 |
| [实现清单](./implementation-checklist.md) | 开发任务分解、工作量估算（含新增功能） | 开发人员、项目经理 |
| [花瓣图实现清单](./petal-implementation.md) | 花瓣图 Canvas 渲染的详细开发任务 | 开发人员 |

---

## 🎯 需求概述

### 核心目标

构建一个灵活的**产品矩阵可视化工具**，支持从多个维度展示和对比竞品，帮助用户直观了解产品在市场中的定位和竞争态势。

### 典型应用场景（以 AP 产品为例）

```
       WiFi 5  WiFi 6  WiFi 6E  WiFi 7
       ┌───────┬───────┬───────┬───────┐
AX5400 │   ●   │  ●○   │       │   ○   │  图例:
       ├───────┼───────┼───────┼───────┤  ● TP-Link
AX3600 │   ●   │ ●●○   │   ○   │       │  ○ 华为
       ├───────┼───────┼───────┼───────┤  ■ Cisco
AX3000 │   ○   │  ●■   │   ○   │   ●   │
       ├───────┼───────┼───────┼───────┤
AX1800 │ ●●○   │   ○   │   ■   │   ○   │
       └───────┴───────┴───────┴───────┘
```

**洞察**：
- TP-Link 在 WiFi 6 + AX3600 区域产品最密集（竞争激烈）
- WiFi 7 + AX5400 是高端市场，目前产品较少（潜在机会）
- 各厂商覆盖率：TP-Link 87.5% | 华为 75.0% | Cisco 50.0%

---

## 新增功能概览

### 1. 产品状态管理 ✨
- **内置枚举字段**：在售/停产/规划中/预售/EOL
- **状态筛选器**：按状态筛选产品
- **状态统计**：各状态产品数量统计和分布分析

### 2. 多维度产品管理

- **通用字段**：品牌、型号、价格、描述、图片、发布日期、**产品状态**
- **自定义维度**：支持离散型（WiFi 5/6/7）和连续型（价格区间 0-5000 元）
- **灵活配置**：运行时动态添加维度，无需修改代码

### 3. 二维矩阵可视化

- **任意维度组合**：X/Y 轴可选择任意两个维度
- **产品定位**：根据维度值自动定位到对应单元格
- **多产品布局**：同一格子内多个产品的智能排列（重叠/堆叠/网格/**花瓣图**）
- **厂商筛选**：显示/隐藏特定厂商的产品

### 4. 🌸 花瓣图可视化（创新功能）

**适用场景**：双离散维度矩阵（如 WiFi 协议 × 速率级别）

```
单元格 (WiFi 6, AX3000):

       ◆ (TP-Link, 大花瓣)
       5 个产品
         ↑
         |
   ------●------
         |
  ◆ (华为, 中) ← | → ◆ (Cisco, 小)
  2 个产品            1 个产品

图例：
◆ = 菱形花瓣
● = 单元格中心
花瓣大小 ∝ 产品数量
```

**核心特性**：
- **厂商位置固定**：基于厂商顺序均匀分布在圆周上（如 6 个厂商对应时钟 12/2/4/6/8/10 点方向）
- **花瓣大小动态**：根据该厂商在该格子的产品数量动态缩放（支持线性/平方根/对数三种模式）
- **多种形状**：菱形/扇形/花瓣/圆形四种可选
- **多维度编码**：
  - **颜色**：厂商主色 / 价格热力 / 产品状态
  - **透明度**：价格 / 产品数量
  - **填充面积**：价格分布比例（状态模式下）
- **交互友好**：Hover 放大，点击查看详情，厂商筛选显隐
- **Canvas 渲染**：高性能、动画流畅

**多维度编码示例**：

*场景 1: 颜色 = 厂商，透明度 = 价格*
- 厂商主色 + 价格越高越不透明
- 一眼看出哪个厂商产品多，哪个厂商价格高

*场景 2: 颜色 = 价格热力，透明度 = 无*
- 蓝→黄→红渐变表示低→中→高价
- 直观展示价格分布

*场景 3: 颜色 = 产品状态，花瓣分区填充*
- 60% 绿色（在售）+ 20% 橙色（预售）+ 20% 灰色（停产）
- 一眼看出产品生命周期分布

### 5. 竞品分析

- **厂商分布图**：各厂商在不同维度组合的产品数量（堆叠柱状图）
- **价格热力图**：矩阵每个区域的平均价格可视化
- **覆盖率分析**：各厂商的市场覆盖广度统计

### 4. 数据导入导出

- **Excel 导出**：5 个工作表（产品列表、厂商配置、维度定义、统计汇总、矩阵数据）
- **Excel 导入**：批量导入产品，支持数据验证和预览
- **模板下载**：根据当前维度定义动态生成导入模板

---

## 🏗️ 技术架构

### 数据模型

```typescript
ProductMatrixChart
├── vendors: MatrixVendor[]          // 厂商列表
├── dimensions: MatrixDimension[]     // 维度定义
├── products: Product[]               // 产品列表
└── matrixConfig: MatrixConfig        // 矩阵配置
```

**存储**：复用现有 `radar_charts` 表，`chart_type: 'product_matrix'`，数据存储在 `data` 字段（JSONB）。

### 功能模块

```
ProductMatrix
├── Config Management (配置管理)
│   ├── VendorConfig (厂商管理)
│   ├── DimensionConfig (维度定义)
│   └── MatrixSettings (矩阵设置)
├── Product Management (产品管理)
│   ├── ProductList (产品列表)
│   ├── ProductForm (产品编辑表单)
│   ├── ProductDetail (产品详情)
│   └── ProductImport (批量导入)
├── Visualization (可视化)
│   ├── MatrixChart (矩阵图表 - ECharts Scatter)
│   ├── VendorFilter (厂商筛选器)
│   └── AxisSelector (轴选择器)
├── Analysis (分析模块)
│   ├── VendorDistribution (厂商分布图)
│   ├── PriceHeatmap (价格热力图)
│   └── CoverageAnalysis (覆盖率分析)
└── I/O (数据导入导出)
    ├── ExcelExporter
    ├── ExcelImporter
    └── TemplateGenerator
```

### 技术栈

| 类别 | 技术 | 用途 |
|------|------|------|
| UI 组件库 | Ant Design 5 | Table, Form, Modal, Drawer, Select, Upload |
| 图表库 | ECharts 5 | Scatter (矩阵图)、Bar (分布图)、Heatmap (热力图) |
| 状态管理 | Zustand | productMatrixActions |
| 拖拽 | @dnd-kit | 厂商/维度/产品排序 |
| Excel | SheetJS (xlsx) | 导入导出 |
| 后端 | Supabase | 数据持久化 |

---

## 📊 可视化方案

### ECharts Scatter（散点图）

**优势**：
- 与现有技术栈一致
- 内置缩放、拖拽、Tooltip
- 支持自定义标记（厂商颜色、形状）
- 图例交互（显示/隐藏厂商）

**配置示例**：

```typescript
const option = {
  xAxis: {
    type: 'category',
    data: ['WiFi 5', 'WiFi 6', 'WiFi 6E', 'WiFi 7']
  },
  yAxis: {
    type: 'category',
    data: ['AX1800', 'AX3000', 'AX3600', 'AX5400']
  },
  series: [{
    type: 'scatter',
    symbolSize: 30,
    data: [
      [0, 0, { product, vendor }],  // WiFi 5 + AX1800
      [1, 1, { product, vendor }],  // WiFi 6 + AX3000
      // ...
    ],
    itemStyle: {
      color: (params) => params.data[2].vendor.color
    }
  }]
}
```

### 单元格内多产品布局

**重叠模式**（推荐）：
- 产品标记围绕单元格中心呈圆形分布
- 偏移半径：10px
- 适合大部分场景，性能好

**堆叠模式**（可选）：
- 产品卡片垂直排列
- 超过 N 个产品时折叠显示 "+N"
- 需要 Canvas 自定义渲染

---

## 📅 开发计划

### 工作量估算

| 阶段 | 内容 | 天数 | 优先级 |
|------|------|------|--------|
| Phase 0 | 新增功能（产品状态 + 花瓣图基础） | 2-3 | P0 (MVP) |
| Phase 1 | 数据模型和基础架构 | 2-3 | P0 (MVP) |
| Phase 2 | 配置管理模块 | 3-4 | P0 (MVP) |
| Phase 3 | 产品管理模块 | 3-4 | P0 (MVP) |
| Phase 4 | 矩阵可视化 | 4-5 | P0 (MVP) |
| Phase 4.5 | 花瓣图可视化（Canvas 渲染） | 3-4 | P0 (MVP) |
| Phase 5 | 分析模块 | 2-3 | P1 (增强) |
| Phase 5.5 | 花瓣图高级特性（多维度编码） | 2-3 | P1 (增强) |
| Phase 6 | 数据导入导出 | 2-3 | P0 (MVP) |
| Phase 7 | 集成和优化 | 2-3 | P0 (MVP) |
| Phase 8 | 测试和文档 | 1-2 | P0 (MVP) |

**总计**：约 **25-37 天**（单人，全职）
- **MVP**：20-27 天（Phase 0, 1-4, 4.5, 6-8）
  - 包含产品状态管理和基础花瓣图可视化
- **增强**：5-10 天（Phase 5, 5.5 + 高级优化）
  - 包含花瓣图多维度编码、分析模块增强

**新增功能影响**：
- 产品状态管理：+2 天
- 花瓣图基础可视化：+3-4 天（Canvas 渲染、交互检测）
- 花瓣图高级特性：+2-3 天（多维度编码、配色方案、导出功能）

### 开发顺序建议

**Week 1**: 基础架构和配置管理 + 产品状态
**Week 2**: 产品管理和矩阵可视化
**Week 3**: 花瓣图可视化（Canvas 渲染 + 交互）
**Week 4**: 完善和集成
**Week 5**: 增强功能（可选：花瓣图多维度编码 + 分析模块）

---

## 🎨 UI 设计

### 主视图布局

```
┌─────────────────────────────────────────────────────────┐
│ Navbar                          [主题] [语言] [用户]    │
├─────────────────────────────────────────────────────────┤
│ Tabs: 📊 Radar | 📈 Timeline | 👥 Manpower | [🔲 产品矩阵] │
├─────────────────────────────────────────────────────────┤
│ Toolbar:                                                │
│   厂商: [√]TP-Link [√]华为 [√]Cisco                    │
│   X轴:[WiFi协议▼] Y轴:[速率级别▼] [⇄交换] [导出]      │
├─────────────────────────────────────────────────────────┤
│                  产品矩阵图表 (ECharts)                 │
│                  (二维散点图，可交互)                   │
│                                                         │
│                   [图例: ●TP-Link ○华为 ■Cisco]        │
├─────────────────────────────────────────────────────────┤
│ [💡 洞察] 覆盖率: TP-Link 87.5% | 华为 75% | Cisco 50% │
└─────────────────────────────────────────────────────────┘
```

### 设置抽屉

```
┌─────────────────────────┐
│ 产品矩阵设置      [× 关闭] │
├─────────────────────────┤
│ ► 厂商管理 (6)          │
│ ► 维度定义 (5)          │
│ ► 产品管理 (68)         │
│ ► 矩阵配置              │
│ ► 统计分析              │
│ ► 数据管理              │
└─────────────────────────┘
```

---

## 🚀 快速开始（开发者）

### 1. 阅读设计文档

```bash
# 按顺序阅读以下文档
1. data-model.md        # 理解数据结构
2. feature-design.md    # 理解功能设计
3. implementation-checklist.md  # 开始开发
```

### 2. 创建基础结构

```bash
# 创建目录结构
src/
├── types/productMatrix.ts
├── stores/radarStore/productMatrixActions.ts
├── components/productMatrix/
│   ├── ProductMatrixView.tsx
│   └── modules/
│       ├── config/
│       ├── product/
│       ├── visualization/
│       └── analysis/
└── services/excel/
    ├── productMatrixExporter.ts
    ├── productMatrixImporter.ts
    └── productMatrixTemplate.ts
```

### 3. 定义类型

```typescript
// src/types/productMatrix.ts
export interface ProductMatrixChart {
  id: string
  name: string
  chart_type: 'product_matrix'
  vendors: MatrixVendor[]
  dimensions: MatrixDimension[]
  products: Product[]
  matrixConfig: MatrixConfig
  // ...
}
```

### 4. 实现 Store Actions

```typescript
// src/stores/radarStore/productMatrixActions.ts
export const addProduct = (chartId: string, product: Product) => {
  // 实现逻辑
}
// ... 其他 CRUD 操作
```

### 5. 开发组件

按 Phase 1-8 的顺序逐步实现各个组件。

---

## 📈 数据示例

### 维度定义示例（AP 产品）

| 维度名称 | 类型 | 选项/范围 |
|----------|------|-----------|
| WiFi 协议 | 离散 | WiFi 5, WiFi 6, WiFi 6E, WiFi 7 |
| 速率级别 | 离散 | AX1800, AX3000, AX3600, AX5400 |
| 价格区间 | 连续 | 0-5000 元 |
| 天线数量 | 连续 | 2-12 根 |
| 适用场景 | 离散 | 家用, 企业, 户外 |

### 产品示例

| 产品名称 | 厂商 | 型号 | 价格 | WiFi 协议 | 速率级别 |
|----------|------|------|------|-----------|----------|
| TP-Link Archer AX55 | TP-Link | Archer AX55 | ¥399 | WiFi 6 | AX3000 |
| 华为 AX3 Pro | 华为 | AX3 Pro | ¥499 | WiFi 6 | AX3000 |
| Cisco Catalyst 9136 | Cisco | Catalyst 9136 | ¥3999 | WiFi 6E | AX5400 |

---

## 🔍 关键决策点

### 1. 为什么选择 ECharts Scatter？

**对比其他方案**：
- ❌ **Canvas 自绘**：开发成本高，需要自己实现交互
- ❌ **D3.js**：学习曲线陡峭，与现有技术栈不一致
- ✅ **ECharts Scatter**：与项目技术栈一致，功能丰富，开发效率高

### 2. 离散维度 vs 连续维度

**离散维度**（如 WiFi 5/6/7）：
- 选项有限且预定义
- 在矩阵中占据独立的行/列
- 用户通过下拉选择

**连续维度**（如价格 0-5000）：
- 数值范围
- 需要分段显示（如 5 段：0-1000, 1000-2000, ...）
- 用户通过数字输入

### 3. 单元格内多产品布局

**推荐：重叠模式（Phase 1）**
- 实现简单，性能好
- 产品标记围绕单元格中心圆形分布
- 适合大部分场景

**可选：堆叠/网格模式（Phase 2，增强功能）**
- 需要 Canvas 自定义渲染
- 适合产品数量特别多的场景

---

## ⚠️ 风险和注意事项

### 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 大数据量性能 | 产品 >200 时 ECharts 可能卡顿 | Canvas 渲染、虚拟化、分页 |
| 布局算法复杂性 | 单元格内多产品排列困难 | 先实现简单的重叠模式 |
| 动态维度验证 | Excel 导入时验证逻辑复杂 | 严格的验证规则 + 详细错误提示 |

### 设计风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 配置流程复杂 | 用户学习成本高 | 提供默认配置、向导引导、示例数据 |
| 矩阵空单元格多 | 视觉效果差 | 支持隐藏空单元格、自动调整布局 |

---

## 📚 相关资源

### 项目文档
- [主项目 CLAUDE.md](../../CLAUDE.md)
- [数据库 Schema](../database/schema.sql)
- [Manpower 优化记录](../manpower/OPTIMIZATION_2026_01.md)

### 外部参考
- [ECharts Scatter 文档](https://echarts.apache.org/en/option.html#series-scatter)
- [Ant Design Table 文档](https://ant.design/components/table/)
- [SheetJS 文档](https://docs.sheetjs.com/)

### 类似产品参考
- Gartner Magic Quadrant（象限图）
- G2 Grid Report（网格对比）
- 波士顿矩阵（BCG Matrix）

---

## 🤝 贡献指南

### 代码规范

遵循项目现有规范（参考 `CLAUDE.md`）：
- TypeScript 严格模式，避免 `any`
- 使用 CSS Modules 进行样式隔离
- 遵循 DRY 原则，避免代码重复
- 每个文件不超过 400 行（TypeScript）

### 提交规范

```
feat(product-matrix): 添加产品列表组件
fix(product-matrix): 修复矩阵图表缩放问题
docs(product-matrix): 更新数据模型文档
```

### 开发流程

1. 创建功能分支：`feature/product-matrix-phase-1`
2. 完成开发和自测
3. 提交 PR，关联 Issue
4. Code Review
5. 合并到主分支

## 🎉 总结

本方案为 Radar Compare 工具设计了一个功能完善、易于扩展的**产品矩阵模块**，主要特点：

### ✅ 核心功能
- **灵活的维度系统**：支持离散和连续两种维度类型
- **强大的可视化**：基于 ECharts 的交互式矩阵图表
- **完善的数据管理**：产品 CRUD + Excel 批量导入导出
- **深度分析能力**：厂商分布、价格热力图、覆盖率统计
- **与现有系统无缝集成**：复用 Supabase 后端、UI 风格一致

### ✨ 创新功能（新增）
- **产品状态管理**：在售/停产/规划/预售/EOL 五种状态，支持筛选和统计
- **花瓣图可视化**：创新的单元格布局方式
  - 厂商位置固定（时钟方向分布）
  - 花瓣大小表示产品数量
  - 多维度编码（颜色 + 透明度 + 填充面积）
  - Canvas 高性能渲染
  - 丰富的交互（Hover、点击、筛选）
  - 4 种花瓣形状（菱形/扇形/花瓣/圆形）

**预计开发时间**：
- 基础功能（不含花瓣图）：15-20 天
- **完整功能（含花瓣图）**：**20-27 天（MVP）** + 5-10 天（增强）

**技术风险**：低（基于成熟技术栈 + Canvas 2D）
**用户价值**：高（满足竞品分析核心需求 + 创新的可视化方式）

让我们开始构建吧！🚀

---

## 📞 联系方式

如有疑问，请联系：
- 产品经理：[姓名]
- 技术负责人：[姓名]
- 设计师：[姓名]

---

## ✅ 检查清单

开始开发前，请确认：

- [ ] 已阅读所有设计文档
- [ ] 理解数据模型和存储方案
- [ ] 熟悉 ECharts 和 Ant Design 的使用
- [ ] 本地环境已配置（Supabase、依赖安装）
- [ ] 已创建功能分支

开发完成后，请确认：

- [ ] 所有 P0 功能已实现
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 文档已更新（CLAUDE.md）
- [ ] 代码已 Review
- [ ] 性能测试通过（>100 产品）

---

## 🎉 总结

本方案为 Radar Compare 工具设计了一个功能完善、易于扩展的**产品矩阵模块**，主要特点：

✅ **灵活的维度系统**：支持离散和连续两种维度类型
✅ **强大的可视化**：基于 ECharts 的交互式矩阵图表
✅ **完善的数据管理**：产品 CRUD + Excel 批量导入导出
✅ **深度分析能力**：厂商分布、价格热力图、覆盖率统计
✅ **与现有系统无缝集成**：复用 Supabase 后端、UI 风格一致

**预计开发时间**：15-20 天（MVP）
**技术风险**：低（基于成熟技术栈）
**用户价值**：高（满足竞品分析核心需求）

让我们开始构建吧！🚀
